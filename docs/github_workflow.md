# GitHub運用ルール

## 1. 用語定義

- `main`:
  - 既定の統合先ブランチ。常に統合可能な状態を維持する。
- `作業ブランチ`:
  - 1つの機能追加または不具合修正を実装するための短命ブランチ。
- `PR (Pull Request)`:
  - ブランチ変更のレビューと統合申請。
- `Draft PR`:
  - レビューは可能だが、まだマージしない前提のPR。

## 2. 基本方針

- 1ブランチ1トピック（1機能追加 or 1修正）を原則とする。
- 作業完了後は `main` 向けにPRを作成する（原則、直接 `main` へpushしない）。
- 作業ブランチには定期的に `main` の最新変更を取り込む（`merge` または `rebase`）。
- 長期間放置される枝分かれブランチを作らない。

## 3. 通常開発フロー（基本）

1. `main` から作業ブランチを作成する。
2. 実装・コミットする。
3. 必要に応じて `main` の更新を取り込む。
4. `main` 向けPRを作成し、レビュー後にマージする。

## 4. Commit運用ルール

- コミット間隔は「10〜30分ごと」を目安にする。
- ただし時間よりも、動作確認できた論理的な最小単位でコミットすることを優先する。
- AIへの1指示で生じた変更は、可能な限り1コミットにまとめる。
- 途中で壊れている状態のコミットは避ける（必要なら `WIP` を明示）。

コミットメッセージ形式:

- `type: summary`

`type` 一覧:

- `feat`: 機能追加（新規ファイル追加を含む）
- `fix`: 不具合修正
- `docs`: ドキュメント修正
- `refactor`: 挙動を変えない構造改善
- `test`: テスト追加・修正
- `chore`: 雑多な保守作業（設定、依存更新など）

例:

- `feat: add record and replay CLI options`
- `fix: correct generated URL in replay output`
- `docs: update github workflow rules`

## 5. PR運用ルール

- 1機能（1目的）につき1PRを原則とする。
- PRは作成から1〜2日以内のマージを目標にする。
- PRタイトルは内容が一読で分かる形式にする。
- 推奨タイトル形式: `type: summary`

PR本文に書く項目の例:

- やったこと（変更内容）
- 確認したこと（テスト/実機確認）
- 懸念点（未解決事項、リスク）

実機確認を実施したPRでは、上記に加えて以下も推奨:

- 実機で実行したコマンド（実行順）
- 実機での結果要約（期待動作/実際の動作/差分）
- 必要に応じてログ、スクリーンショット、動画へのリンク

`main` への直接pushについて:

- 少人数開発でも、方針変更・機能追加・不具合修正はPR経由を原則とする。
- 直接pushを許容するのは、誤字修正など方針・挙動に影響しない軽微変更に限定する。

## 6. 実機運用 + AI大規模変更時のフロー

実機運用ブランチに大量変更が入り、そのままでは `main` に統合しづらい場合は、以下を徹底する。

### 6.1 ハードウェアよりや共通部分など長時間放置してはいけない変更がある場合

対象例:

- `openk/damiao/*`
- `openk/openk-1-alpha_follower2/*`
- `openk/openk-1-sts_leader/*`
- `scripts/openk_teleoperate.py`
- `scripts/openk_record.py`

手順:

1. `main` から統合用ブランチを作成する。
2. 実機運用ブランチから必要なコミットのみ `cherry-pick` する。
3. PRを作成し、レビュー後に `main` へマージする。

### 6.2 実機では動作するが、そのままでは `main` に統合できない場合

1. 実機運用ブランチ（例: `ops/follower2-live`）に対して、まず `Draft PR` を作成する。
2. その実機運用ブランチを起点に、`main` 統合用ブランチ（例: `integrate/follower2-live-to-main`）を新規作成する。
3. 統合用ブランチで `main` との差分を解消し、通常PRを作成する。
4. そのPRの内容で実機が同等に動作することを確認する。
5. 問題なければ統合用ブランチ(`integrate/follower2-live-to-main`)を `main` にマージする。
6. 最後に、実機運用ブランチ(`ops/follower2-live`)へ `main` をマージして差分を再同期する（必須）。

## 7. ブランチ命名規則

形式:

- `<type>/<scope>-<short-description>`

`type` 一覧:

- `feat`: 機能追加
- `fix`: 不具合修正
- `refactor`: リファクタリング（挙動変更なし）
- `docs`: ドキュメント修正
- `test`: テスト追加・修正
- `ops`: 実機運用中の長寿命ブランチ
- `integrate`: `main` 統合用ブランチ

命名例:

- `feat/record-cli-args`
- `fix/replay-timestamp-bug`
- `ops/follower2-live`
- `integrate/follower2-live-to-main`

## 8. Issue運用（現時点では任意）

- Issueは、課題・背景・完了条件を整理して残すための機能。
- 現時点では、Issueの利用を必須にはしない。
- ただし、変更規模が大きい作業、実機確認が必要な作業、複数人で追う作業では、Issueを使うと管理しやすい。
- 今後の運用状況を見ながら、Issueをより積極的に使う方針へ移行する可能性がある。

Issueを作る場合の最小項目（推奨）:

- 背景（なぜやるか）
- 目的または完了条件（何をもって完了とするか）
- 関連PR（あればリンク）
